{"version":3,"file":"wishlist.js","sources":["../src/wishlist.js"],"sourcesContent":["// wishlist.js\r\nimport { fetchProductsById } from \"./js/products-api.js\";\r\nimport { renderProducts, renderProductInModal } from \"./js/render-functions.js\";\r\nimport { refs } from \"./js/refs.js\";\r\nimport {\r\n  getWishlist,\r\n  addToWishlist,\r\n  removeFromWishlist,\r\n  isInWishlist,\r\n  addToCart,\r\n  isInCart,\r\n  removeFromCart,\r\n  getCart\r\n} from \"./js/storage.js\";\r\nimport { changeTheme } from \"./js/helpers.js\";\r\n\r\n\r\n\r\nconst updateNavCount = () => {\r\n  const wishlist = getWishlist();\r\n  const navCount = document.querySelector('[data-wishlist-count]');\r\n  if (navCount) {\r\n    navCount.textContent = wishlist.length;\r\n  }\r\n  console.log('Wishlist count updated:', wishlist.length);\r\n};\r\n\r\nconst updateNavCountCart = () => {\r\n  const cart = getCart();\r\n  const totalQuantity = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);\r\n  const navCountCart = document.querySelector('[data-cart-count]');\r\n  if (navCountCart) {\r\n    navCountCart.textContent = totalQuantity;\r\n  }\r\n  console.log('Cart count updated:', totalQuantity);\r\n};\r\n\r\n\r\n\r\nconst updateWishlistButton = (productId) => {\r\n  const wishButton = document.querySelector('.modal-product__btn--wishlist');\r\n  if (!wishButton) return;\r\n\r\n  const id = Number(productId);\r\n  if (isInWishlist(id)) {\r\n    wishButton.textContent = 'Remove from Wishlist';\r\n  } else {\r\n    wishButton.textContent = 'Add to Wishlist';\r\n  }\r\n};\r\n\r\nconst updateCartButton = (productId) => {\r\n  const cartButton = document.querySelector('.modal-product__btn--cart');\r\n  if (!cartButton) return;\r\n\r\n  const id = Number(productId);\r\n  if (isInCart(id)) {\r\n    cartButton.textContent = \"Remove from Cart\";\r\n  } else {\r\n    cartButton.textContent = \"Add to Cart\";\r\n  }\r\n};\r\n\r\n\r\nconst loadWishlistProducts = async () => {\r\n  const productsList = document.querySelector('ul.products');\r\n  const notFoundDiv = document.querySelector('.not-found');\r\n  const wishlist = getWishlist();\r\n\r\n  console.log('Loading wishlist products:', wishlist);\r\n\r\n  if (wishlist.length === 0) {\r\n    if (notFoundDiv) notFoundDiv.classList.add('not-found--visible');\r\n    if (productsList) productsList.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const productPromises = wishlist.map(id => fetchProductsById(id));\r\n    const products = await Promise.all(productPromises);\r\n\r\n    console.log('Products loaded:', products);\r\n\r\n    if (notFoundDiv) notFoundDiv.classList.remove('not-found--visible');\r\n    renderProducts(products);\r\n  } catch (error) {\r\n    console.error('Помилка при завантаженні wishlist:', error);\r\n    if (notFoundDiv) notFoundDiv.classList.add('not-found--visible');\r\n    if (productsList) productsList.innerHTML = '';\r\n  }\r\n};\r\n\r\n\r\ndocument.addEventListener(\"click\", async (event) => {\r\n  const productsList = document.querySelector('ul.products');\r\n\r\n  const productItem = event.target.closest(\"li.products__item\");\r\n  if (productItem && productsList && productsList.contains(productItem)) {\r\n    const productId = Number(productItem.dataset.id);\r\n    if (!productId) return;\r\n\r\n    try {\r\n      const product = await fetchProductsById(productId);\r\n      renderProductInModal(product);\r\n\r\n      const modal = document.querySelector('.modal');\r\n      if (modal) modal.classList.add(\"modal--is-open\");\r\n\r\n      updateWishlistButton(productId);\r\n      updateCartButton(productId);\r\n\r\n      setTimeout(() => {\r\n        const wishButton = document.querySelector('.modal-product__btn--wishlist');\r\n        if (wishButton) {\r\n          wishButton.onclick = (e) => {\r\n            e.stopPropagation();\r\n            const id = Number(productId);\r\n\r\n            if (isInWishlist(id)) {\r\n              removeFromWishlist(id);\r\n              console.log('Removed from wishlist:', id);\r\n            } else {\r\n              addToWishlist(id);\r\n              console.log('Added to wishlist:', id);\r\n            }\r\n\r\n            updateWishlistButton(id);\r\n            updateNavCount();\r\n            loadWishlistProducts();\r\n          };\r\n        }\r\n\r\n        const cartButton = document.querySelector('.modal-product__btn--cart');\r\n        if (cartButton) {\r\n          cartButton.onclick = (e) => {\r\n            e.stopPropagation();\r\n            const id = Number(productId);\r\n\r\n            if (isInCart(id)) {\r\n              removeFromCart(id);\r\n              console.log('Removed from cart:', id);\r\n            } else {\r\n              addToCart(id, 1);\r\n              console.log('Added to cart:', id);\r\n\r\n              if (isInWishlist(id)) {\r\n                removeFromWishlist(id);\r\n                updateNavCount();\r\n                loadWishlistProducts();\r\n              }\r\n            }\r\n\r\n            updateCartButton(id);\r\n            updateNavCountCart();\r\n          };\r\n        }\r\n      }, 0);\r\n    } catch (error) {\r\n      console.error('Помилка при завантаженні продукту:', error);\r\n    }\r\n  }\r\n\r\n  const modal = document.querySelector('.modal');\r\n  if (modal && (event.target === modal || event.target.classList.contains(\"modal__close-btn\"))) {\r\n    modal.classList.remove(\"modal--is-open\");\r\n  }\r\n});\r\n\r\n\r\nwindow.addEventListener('storage', (e) => {\r\n  if (e.key === 'wishlist') {\r\n    console.log('Storage changed, reloading wishlist');\r\n    loadWishlistProducts();\r\n    updateNavCount();\r\n  }\r\n  if (e.key === 'cart') {\r\n    updateNavCountCart();\r\n  }\r\n});\r\n\r\n\r\nwindow.addEventListener('wishlistUpdated', () => {\r\n  console.log('Wishlist updated event received');\r\n  loadWishlistProducts();\r\n  updateNavCount();\r\n});\r\n\r\nwindow.addEventListener('cartUpdated', () => {\r\n  console.log('Cart updated event received');\r\n  updateNavCountCart();\r\n});\r\n\r\n\r\nconst initPage = () => {\r\n  console.log('Initializing wishlist page...');\r\n\r\n  changeTheme();\r\n  loadWishlistProducts();\r\n  updateNavCount();\r\n  updateNavCountCart();\r\n\r\n  console.log('Page initialized');\r\n};\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  initPage();\r\n});\r\n\r\n\r\nwindow.addEventListener('focus', () => {\r\n  console.log('Page focused, reloading wishlist');\r\n  loadWishlistProducts();\r\n  updateNavCount();\r\n  updateNavCountCart();\r\n});"],"names":["updateNavCount","wishlist","getWishlist","navCount","updateNavCountCart","totalQuantity","getCart","sum","item","navCountCart","updateWishlistButton","productId","wishButton","id","isInWishlist","updateCartButton","cartButton","isInCart","loadWishlistProducts","productsList","notFoundDiv","productPromises","fetchProductsById","products","renderProducts","error","event","productItem","product","renderProductInModal","modal","e","removeFromWishlist","addToWishlist","removeFromCart","addToCart","initPage","changeTheme"],"mappings":"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"}