{"version":3,"file":"cart.js","sources":["../src/cart.js"],"sourcesContent":["// cart.js\r\nimport { fetchProductsById } from \"./js/products-api.js\";\r\nimport { renderProducts, renderProductInModal } from \"./js/render-functions.js\";\r\nimport { refs } from \"./js/refs.js\";\r\nimport {\r\n  getCart,\r\n  addToCart,\r\n  removeFromCart,\r\n  isInCart,\r\n  getWishlist,\r\n  saveCart,\r\n  updateCartItem,\r\n  clearCart\r\n} from \"./js/storage.js\";\r\nimport iziToast from \"izitoast\";\r\nimport { changeTheme } from \"./js/helpers.js\";\r\n\r\n\r\nconst updateNavCount = () => {\r\n  const wishlist = getWishlist();\r\n  if (refs.navCount) {\r\n    refs.navCount.textContent = wishlist.length;\r\n  }\r\n};\r\n\r\n\r\nconst updateNavCountCart = () => {\r\n  const cart = getCart();\r\n  const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);\r\n  if (refs.navCountCart) {\r\n    refs.navCountCart.textContent = totalCount;\r\n  }\r\n};\r\n\r\n\r\nconst updateCartButton = (productId) => {\r\n  if (!refs.cartButton) return;\r\n\r\n  const id = Number(productId);\r\n  if (isInCart(id)) {\r\n    refs.cartButton.textContent = 'Remove from Cart';\r\n  } else {\r\n    refs.cartButton.textContent = 'Add to Cart';\r\n  }\r\n};\r\n\r\n\r\nconst updateCartSummary = async () => {\r\n  const cart = getCart();\r\n\r\n  if (cart.length === 0) {\r\n    if (refs.cartCount) refs.cartCount.textContent = \"0\";\r\n    if (refs.cartPrice) refs.cartPrice.textContent = \"$0.00\";\r\n    return;\r\n  }\r\n\r\n  const validCartItems = cart.filter(item => typeof item.id !== 'undefined');\r\n\r\n  if (validCartItems.length === 0) {\r\n    if (refs.cartCount) refs.cartCount.textContent = \"0\";\r\n    if (refs.cartPrice) refs.cartPrice.textContent = \"$0.00\";\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const products = await Promise.all(validCartItems.map(item => fetchProductsById(item.id)));\r\n\r\n    const totalCount = validCartItems.reduce((sum, item) => sum + item.quantity, 0);\r\n    if (refs.cartCount) refs.cartCount.textContent = totalCount;\r\n\r\n    const totalPrice = products.reduce((sum, product) => {\r\n      const matchingItems = validCartItems.filter(i => Number(i.id) === Number(product.id));\r\n      const quantity = matchingItems.reduce((qSum, i) => qSum + i.quantity, 0);\r\n      return sum + product.price * quantity;\r\n    }, 0);\r\n\r\n    if (refs.cartPrice) refs.cartPrice.textContent = `$${totalPrice.toFixed(2)}`;\r\n  } catch (error) {\r\n    console.error('Помилка при оновленні підсумку кошика:', error);\r\n    if (refs.cartCount) refs.cartCount.textContent = \"0\";\r\n    if (refs.cartPrice) refs.cartPrice.textContent = \"$0.00\";\r\n  }\r\n};\r\n\r\n\r\nconst loadCartProducts = async () => {\r\n  const cart = getCart();\r\n\r\n  if (cart.length === 0) {\r\n    if (refs.notFoundDiv) refs.notFoundDiv.classList.add('not-found--visible');\r\n    refs.productsList.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  const validCartItems = cart.filter(item => typeof item.id !== 'undefined');\r\n\r\n  if (validCartItems.length === 0) {\r\n    if (refs.notFoundDiv) refs.notFoundDiv.classList.add('not-found--visible');\r\n    refs.productsList.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const products = await Promise.all(validCartItems.map(item => fetchProductsById(item.id)));\r\n\r\n    const productsWithQuantity = products.map(product => {\r\n      const cartItem = validCartItems.find(i => Number(i.id) === Number(product.id));\r\n      return {\r\n        ...product,\r\n        quantity: cartItem ? cartItem.quantity : 1\r\n      };\r\n    });\r\n\r\n    if (refs.notFoundDiv) refs.notFoundDiv.classList.remove('not-found--visible');\r\n    renderProducts(productsWithQuantity);\r\n\r\n    const quantityElements = document.querySelectorAll(\".product-quantity\");\r\n    quantityElements.forEach(el => el.classList.remove(\"hidden\"));\r\n  } catch (error) {\r\n    console.error('Помилка при завантаженні продуктів кошика:', error);\r\n    if (refs.notFoundDiv) refs.notFoundDiv.classList.add('not-found--visible');\r\n    refs.productsList.innerHTML = '';\r\n  }\r\n};\r\n\r\nrefs.productsList?.addEventListener(\"click\", async (event) => {\r\n  const target = event.target;\r\n\r\n\r\n  if (target.classList.contains('quantity-button')) {\r\n    return;\r\n  }\r\n\r\n  const productItem = target.closest(\"li.products__item\");\r\n  if (!productItem) return;\r\n\r\n  const productId = Number(productItem.dataset.id);\r\n  if (!productId) return;\r\n\r\n  try {\r\n    const product = await fetchProductsById(productId);\r\n    renderProductInModal(product);\r\n    if (refs.modal) refs.modal.classList.add(\"modal--is-open\");\r\n\r\n    updateCartButton(productId);\r\n\r\n    if (refs.cartButton) {\r\n      refs.cartButton.onclick = async () => {\r\n        const id = Number(productId);\r\n\r\n        if (isInCart(id)) {\r\n          removeFromCart(id);\r\n        } else {\r\n          addToCart(id, 1);\r\n        }\r\n\r\n        updateCartButton(id);\r\n        updateNavCountCart();\r\n        await loadCartProducts();\r\n        await updateCartSummary();\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('Помилка при завантаженні продукту:', error);\r\n  }\r\n});\r\n\r\n\r\nrefs.cartSummaryButton?.addEventListener('click', async () => {\r\n  const cart = getCart();\r\n\r\n  if (cart.length === 0) {\r\n    iziToast.warning({\r\n      title: 'Oops!',\r\n      message: 'Your cart is empty!',\r\n      position: \"topLeft\"\r\n    });\r\n    return;\r\n  }\r\n\r\n  iziToast.success({\r\n    title: 'Success!',\r\n    message: 'Products purchased successfully!',\r\n    position: \"topLeft\"\r\n  });\r\n\r\n  clearCart();\r\n  await loadCartProducts();\r\n  updateNavCountCart();\r\n  await updateCartSummary();\r\n});\r\n\r\nrefs.modal?.addEventListener(\"click\", (event) => {\r\n  if (event.target === refs.modal || event.target.classList.contains(\"modal__close-btn\")) {\r\n    refs.modal.classList.remove(\"modal--is-open\");\r\n  }\r\n});\r\n\r\n\r\ndocument.addEventListener(\"click\", async (event) => {\r\n  const plusBtn = event.target.closest(\".plus-button\");\r\n  const minusBtn = event.target.closest(\".minus-button\");\r\n\r\n  if (plusBtn || minusBtn) {\r\n    const productDiv = event.target.closest(\".product\");\r\n    if (!productDiv) return;\r\n\r\n    const productId = Number(productDiv.dataset.id);\r\n    if (!productId) return;\r\n\r\n    const input = productDiv.querySelector(\".quantity-input\");\r\n    if (!input) return;\r\n\r\n    let quantity = parseInt(input.value, 10) || 0;\r\n\r\n    if (plusBtn) {\r\n      quantity += 1;\r\n    } else if (minusBtn && quantity > 0) {\r\n      quantity -= 1;\r\n    }\r\n\r\n    input.value = quantity;\r\n\r\n    if (quantity > 0) {\r\n      updateCartItem(productId, quantity);\r\n    } else {\r\n      removeFromCart(productId);\r\n      await loadCartProducts();\r\n    }\r\n\r\n    await updateCartSummary();\r\n    updateNavCountCart();\r\n  }\r\n});\r\n\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  changeTheme();\r\n  loadCartProducts();\r\n  updateNavCountCart();\r\n  updateNavCount();\r\n  updateCartSummary();\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["updateNavCount","wishlist","getWishlist","refs","updateNavCountCart","totalCount","getCart","sum","item","updateCartButton","productId","id","isInCart","updateCartSummary","cart","validCartItems","products","fetchProductsById","totalPrice","product","quantity","i","qSum","error","loadCartProducts","productsWithQuantity","cartItem","renderProducts","el","_a","event","target","productItem","renderProductInModal","removeFromCart","addToCart","iziToast","clearCart","plusBtn","minusBtn","productDiv","input","updateCartItem","changeTheme"],"mappings":"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"}